import{F as E,c as F,a as f}from"./FormInput-C5ftnFIk.js";import{M as w}from"./MyButton-DrcBuMc_.js";import{c as I}from"./user-BCqFKrhh.js";import{_ as y,c as b,a as s,e as i,r as d,w as C,f as h,h as g,o as c,t as k,g as v,d as V}from"./index-BLcxalff.js";import{M as A}from"./SwitchButton-M956E4O3.js";import{h as S}from"./http-BgvyJrsg.js";import{g as N}from"./admin-yvFpIYIl.js";import{g as x}from"./supervisor-yvFpIYIl.js";import{g as D}from"./recruiter-CVXVC8vy.js";import"./conversors-a5ARN5za.js";const M={name:"RegisterCard",components:{FormInput:E,MyButton:w},props:{dataForm:{type:Object}},data(){return{form:{},localForm:this.dataForm,errors:{},loading:!1}},methods:{validate(){F({name:f().min(3,"Nome deve ter pelo menos 3 caracteres").required("Nome é obrigatório"),email:f().email("E-mail inválido").required("E-mail é obrigatório"),password:f().min(6,"Senha deve ter pelo menos 6 caracteres").required("Senha é obrigatória"),phoneNumber:f().matches(/^\(\d{2}\)\s\d{4,5}-\d{4}$/,"Telefone deve estar no formato (12) 12345-1234").required("Telefone é obrigatório")}).validate(this.form,{abortEarly:!1}).then(()=>{this.errors={},this.registerAccount()}).catch(e=>{const a={};e.inner.forEach(n=>{a[n.path]=n.message}),this.errors=a})},async registerAccount(){this.loading=!0;try{await I(this.form),this.$snotify.success("Cadastro realizado com sucesso!"),this.localForm.type="login"}catch(o){this.$snotify.error("Erro ao cadastrar: "+o.message)}finally{this.loading=!1}}}};function B(o,e,a,n,r,u){const l=d("FormInput"),p=d("MyButton");return c(),b("form",{class:"card",onSubmit:e[5]||(e[5]=g((...t)=>u.validate&&u.validate(...t),["stop","prevent"]))},[e[8]||(e[8]=s("h2",null,"Criar conta",-1)),i(l,{label:"Nome",modelValue:r.form.name,"onUpdate:modelValue":e[0]||(e[0]=t=>r.form.name=t),error:r.errors.name,type:"text",placeholder:"Digite seu nome"},null,8,["modelValue","error"]),i(l,{label:"E-mail",modelValue:r.form.email,"onUpdate:modelValue":e[1]||(e[1]=t=>r.form.email=t),error:r.errors.email,type:"email",placeholder:"Digite seu e-mail"},null,8,["modelValue","error"]),i(l,{label:"Senha",modelValue:r.form.password,"onUpdate:modelValue":e[2]||(e[2]=t=>r.form.password=t),error:r.errors.password,type:"password",placeholder:"Digite sua senha"},null,8,["modelValue","error"]),i(l,{label:"Telefone",modelValue:r.form.phoneNumber,"onUpdate:modelValue":e[3]||(e[3]=t=>r.form.phoneNumber=t),error:r.errors.phoneNumber,type:"tel",placeholder:"(99) 99999-9999",mask:"tel"},null,8,["modelValue","error"]),i(p,{class:"primary",loading:r.loading},{default:C(()=>e[6]||(e[6]=[h("Cadastrar")])),_:1},8,["loading"]),e[9]||(e[9]=s("hr",null,null,-1)),s("span",null,[e[7]||(e[7]=h(" Já é cadastrado? ")),s("a",{href:"#",onClick:e[4]||(e[4]=g(t=>r.localForm.type="login",["prevent"]))},"Entrar")])],32)}const R=y(M,[["render",B],["__scopeId","data-v-6697a36d"]]),q=o=>S.api().post("/auth/login",o),U=o=>S.api().post("/auth/login-candidate",o),L=o=>S.api().post("/login/remember",o),T={name:"LoginCard",components:{FormInput:E,MyButton:w,MySwitch:A},props:{dataForm:{type:Object}},data(){return{form:{},localForm:this.dataForm,errors:{},loading:!1,admin:!1}},methods:{validate(){F({email:f().email("E-mail inválido").required("E-mail é obrigatório"),password:f().min(6,"Senha deve ter pelo menos 6 caracteres").required("Senha é obrigatória")}).validate(this.form,{abortEarly:!1}).then(()=>{this.errors={},this.loginAccount()}).catch(e=>{const a={};e.inner.forEach(n=>{a[n.path]=n.message}),this.errors=a})},async loginAccount(){this.loading=!0;try{const o=await(this.admin?q(this.form):U(this.form));this.setAuth(o.data.access_token,o.data.permission,o.data.uid)}catch(o){o.response.status===401?this.$snotify.error("E-mail ou senha inválidos"):o.response.status===403?this.$snotify.error("Acesso negado"):this.$snotify.error("Erro ao logar: "+o.message)}finally{this.loading=!1}},setAuth(o,e,a){localStorage.setItem("login","true"),localStorage.setItem("token",o),localStorage.setItem("role",e),localStorage.setItem("uid",a.toString()),this.sendToDashboard(e)},async sendToDashboard(o){switch(o){case 1:const{data:e}=await N(Number(localStorage.getItem("uid")));localStorage.setItem("name",e.name),this.$router.push({name:"adminDashboard"});return;case 2:const{data:a}=await x(Number(localStorage.getItem("uid")));localStorage.setItem("name",a.name),this.$router.push({name:"supervisorDashboard"});return;case 3:const{data:n}=await D(Number(localStorage.getItem("uid")));localStorage.setItem("name",n.name),this.$router.push({name:"recruiterDashboard"});return;case 4:const r=this.$route.query.redirect;this.$router.push(r?{name:"userVacancyDetail",params:{id:r}}:{name:"userAplication"});return;default:this.$snotify.error("Erro ao logar: Regra invalida");return}}}},_={class:"flex"};function j(o,e,a,n,r,u){const l=d("FormInput"),p=d("MySwitch"),t=d("MyButton");return c(),b("form",{class:"card",onSubmit:e[6]||(e[6]=g((...m)=>u.validate&&u.validate(...m),["stop","prevent"]))},[e[9]||(e[9]=s("h2",null,"Login",-1)),i(l,{label:"E-mail",modelValue:r.form.email,"onUpdate:modelValue":e[0]||(e[0]=m=>r.form.email=m),error:r.errors.email,type:"email",placeholder:"Digite seu e-mail"},null,8,["modelValue","error"]),i(l,{label:"Senha",modelValue:r.form.password,"onUpdate:modelValue":e[1]||(e[1]=m=>r.form.password=m),error:r.errors.password,type:"password",placeholder:"Digite sua senha"},null,8,["modelValue","error"]),s("div",_,[i(p,{modelValue:r.admin,"onUpdate:modelValue":e[2]||(e[2]=m=>r.admin=m)},null,8,["modelValue"]),s("span",{onClick:e[3]||(e[3]=m=>r.admin=!r.admin)},k(r.admin?"Empresa":"Candidato"),1)]),s("a",{href:"#",onClick:e[4]||(e[4]=g(m=>r.localForm.type="forgot-password",["prevent"]))},"Esqueci minha senha"),i(t,{class:"primary",loading:r.loading},{default:C(()=>e[7]||(e[7]=[h("Entrar")])),_:1},8,["loading"]),e[10]||(e[10]=s("hr",null,null,-1)),s("span",null,[e[8]||(e[8]=h(" Ainda não tem conta? ")),s("a",{href:"#",onClick:e[5]||(e[5]=g(m=>r.localForm.type="register",["prevent"]))},"Cadastre-se")])],32)}const O=y(T,[["render",j],["__scopeId","data-v-3fac155a"]]),z={name:"RememberCard",components:{FormInput:E,MyButton:w},props:{dataForm:{type:Object}},data(){return{form:{},localForm:this.dataForm,errors:{},loading:!1}},methods:{validate(){F({email:f().email("E-mail inválido").required("E-mail é obrigatório")}).validate(this.form,{abortEarly:!1}).then(()=>{this.errors={},this.rememberAccount()}).catch(e=>{const a={};e.inner.forEach(n=>{a[n.path]=n.message}),this.errors=a})},async rememberAccount(){this.loading=!0;try{await L(this.form)}catch(o){this.$snotify.error("Erro ao recuperar senha: "+o.message)}finally{this.loading=!1}}}};function J(o,e,a,n,r,u){const l=d("FormInput"),p=d("MyButton");return c(),b("form",{class:"card",onSubmit:e[2]||(e[2]=g((...t)=>u.validate&&u.validate(...t),["stop","prevent"]))},[e[5]||(e[5]=s("h2",null,"Recuperar Senha",-1)),i(l,{label:"E-mail",modelValue:r.form.email,"onUpdate:modelValue":e[0]||(e[0]=t=>r.form.email=t),error:r.errors.email,type:"email",placeholder:"Digite seu e-mail"},null,8,["modelValue","error"]),i(p,{class:"primary",loading:r.loading},{default:C(()=>e[3]||(e[3]=[h("Recuperar")])),_:1},8,["loading"]),e[6]||(e[6]=s("hr",null,null,-1)),s("span",null,[e[4]||(e[4]=h(" Lembrou sua senha? ")),s("a",{href:"#",onClick:e[1]||(e[1]=g(t=>r.localForm.type="login",["prevent"]))},"Entrar")])],32)}const G=y(z,[["render",J],["__scopeId","data-v-bdd2fe94"]]),H={name:"LoginView",components:{LoginCard:O,RegisterCard:R,RememberCard:G},data(){return{form:{type:"login"}}},methods:{}};function K(o,e,a,n,r,u){const l=d("LoginCard"),p=d("RegisterCard"),t=d("RememberCard");return c(),b("main",null,[r.form.type==="login"?(c(),v(l,{key:0,dataForm:r.form},null,8,["dataForm"])):V("",!0),r.form.type==="register"?(c(),v(p,{key:1,dataForm:r.form},null,8,["dataForm"])):V("",!0),r.form.type==="forgot-password"?(c(),v(t,{key:2,dataForm:r.form},null,8,["dataForm"])):V("",!0)])}const te=y(H,[["render",K],["__scopeId","data-v-61a27157"]]);export{te as default};
