import{D}from"./DataTable-_upT_8j8.js";import{I as V,_ as C,h as M,w as d,e as s,f,r as c,a as n,t as _,o as m,c as h,b as k,n as I,F as v,i as b}from"./index-a9nTiWfv.js";import{r as S,u as x,l as E}from"./vacancy-BHEFVFCQ.js";import{g as O}from"./filters-CQa4tUMQ.js";import{M as B}from"./ModalBase-3yN9nkm2.js";import{M as T}from"./MyButton-BaKho14X.js";import"./SearchInput-D_MKQ2lK.js";import"./conversors-C7hpOq9I.js";import"./http-DXe0wLyF.js";const F={name:"DeleteVacancyModal",components:{ModalBase:B,Icon:V,MyButton:T},props:{show:{type:Boolean,default:!1},dataForm:{type:Object}},emits:["onClose","onConfirm"],data(){return{loading:!1}},methods:{async deleteVacancy(){this.loading=!0;try{await S(this.dataForm.id),this.$snotify.success("Vaga excluída com sucesso!"),this.$emit("onConfirm"),this.$emit("onClose")}catch(e){this.$snotify.error("Erro ao excluir a vaga: "+e)}finally{this.loading=!1}}}};function L(e,t,o,u,a,l){const i=c("Icon"),p=c("MyButton"),g=c("ModalBase");return m(),M(g,{open:o.show,loading:a.loading,title:"Confirmar Exclusão",onOnClose:t[0]||(t[0]=w=>e.$emit("onClose"))},{content:d(()=>[n("section",null,[s(i,{icon:"carbon:warning"}),n("div",null,[n("p",null,[t[1]||(t[1]=f(" Tem certeza que deseja excluir a vaga ")),n("span",null,_(o.dataForm?.title),1),t[2]||(t[2]=f(" ? "))]),t[3]||(t[3]=n("p",null,"Essa ação não pode ser desfeita!",-1))])])]),actions:d(()=>[s(p,{class:"btn danger",loading:a.loading,onClick:l.deleteVacancy},{default:d(()=>t[4]||(t[4]=[f("Confirmar")])),_:1},8,["loading","onClick"])]),_:1},8,["open","loading"])}const N=C(F,[["render",L],["__scopeId","data-v-e1b7b5e3"]]),z={name:"RecruiterVacancy",components:{DataTable:D,DeleteVacancyModal:N,Icon:V},data(){return{openDropdownItem:null,dropdownStyles:{position:"absolute",top:"0px",left:"0px"},showDeleteVacancyModal:!1,loading:!1,columns:[{key:"title",title:"Título"},{key:"employmentType",title:"Tipo de vaga"},{key:"status",title:"Status"},{key:"expirationDate",title:"Data de Expiração",type:"date"}],items:[],editItem:{},vacancyStatus:[],total:0,page:1,search:""}},mounted(){this.getVacancies(),this.getVacancyStatus(),document.addEventListener("click",this.handleClickOutside)},beforeUnmount(){document.removeEventListener("click",this.handleClickOutside)},methods:{refresh(){this.items=[],this.getVacancies()},async getVacancyStatus(){try{const e=await O();this.vacancyStatus=e.data}catch(e){this.$snotify.error("Erro ao carregar status de vagas: "+e)}},async getVacancies(){this.closeAllModals(),this.loading=!0;try{const e=await E(this.filters);this.items.push(...e.data.vacancies),this.total=e.data.total}catch(e){this.$snotify.error(e)}finally{this.loading=!1}},handleSearch(e){this.search=e,this.page=1,this.items=[],this.getVacancies()},handleConfirmDelete(e){this.editItem=e,this.showDeleteVacancyModal=!0},closeAllModals(){this.editItem={},this.showDeleteVacancyModal=!1},handleLoadMore(){this.page++,this.getVacancies()},async handleToggleVacancy(e,t){this.loading=!0;const o={...e};try{o.status=t,delete o.id,delete o.slug,delete o.createdAt,delete o.position,delete o.department,await x(e.id,o),this.$snotify.success("Vaga atualizada com sucesso!"),this.refresh()}catch(u){this.$snotify.error("Erro ao atualizar a vaga: "+u)}finally{this.openDropdownItem=null,this.loading=!1}},toggleDropdown(e,t){const o=e.target.getBoundingClientRect();if(this.openDropdownItem===t){this.openDropdownItem=null;return}this.dropdownStyles={position:"absolute",top:`${o.bottom+window.scrollY+10}px`,left:`${o.left+window.scrollX-30}px`},this.openDropdownItem=t},handleClickOutside(e){setTimeout(()=>{const t=this.$refs.dropdown,o=e.target,u=e.target.closest(".actions");t&&!t.contains(o)&&!u&&(this.openDropdownItem=null)},0)}},computed:{filters(){return{page:this.page,search:this.search}},loadMore(){return this.items.length<this.total}}},A={class:"card"},R=["onClick"],$=["onClick"],j=["onClick"];function q(e,t,o,u,a,l){const i=c("Icon"),p=c("RouterLink"),g=c("DataTable"),w=c("DeleteVacancyModal");return m(),h("main",null,[n("section",A,[n("header",null,[t[1]||(t[1]=n("h1",null,"Vagas",-1)),n("button",{class:"rounded",onClick:t[0]||(t[0]=()=>e.$router.push({name:"recruiterVacancyForm"})),title:"Nova Vaga"},[s(i,{icon:"qlementine-icons:new-16"})])]),s(g,{items:a.items,columns:a.columns,loading:a.loading,total:a.total,loadMore:l.loadMore,onOnLoadMore:l.handleLoadMore,onOnSearch:l.handleSearch},{actions:d(({item:r})=>[n("button",{class:"rounded",onClick:y=>l.toggleDropdown(y,r),title:"Editar Status"},[s(i,{icon:"fluent:status-12-filled"})],8,R),s(p,{class:"rounded primary",to:{name:"recruiterVacancyDetail",params:{id:r.id}},title:"Ver Candidatos"},{default:d(()=>[s(i,{icon:"mdi:user"})]),_:2},1032,["to"]),s(p,{class:"rounded success",to:{name:"recruiterVacancyForm",params:{id:r.id}},title:"Editar"},{default:d(()=>[s(i,{icon:"carbon:edit"})]),_:2},1032,["to"]),n("button",{class:"rounded danger",onClick:y=>l.handleConfirmDelete(r),title:"Excluir"},[s(i,{icon:"carbon:trash-can"})],8,$)]),_:1},8,["items","columns","loading","total","loadMore","onOnLoadMore","onOnSearch"])]),a.openDropdownItem?(m(),h("article",{key:0,ref:"dropdown",style:I(a.dropdownStyles),class:"dropdown-status"},[n("ul",null,[(m(!0),h(v,null,b(a.vacancyStatus,r=>(m(),h("li",{key:r.id,onClick:y=>l.handleToggleVacancy(a.openDropdownItem,r.title)},_(r.title),9,j))),128))])],4)):k("",!0),s(w,{show:a.showDeleteVacancyModal,dataForm:a.editItem,onOnClose:l.closeAllModals,onOnConfirm:l.refresh},null,8,["show","dataForm","onOnClose","onOnConfirm"])])}const W=C(z,[["render",q],["__scopeId","data-v-a7d7ce5e"]]);export{W as default};
