import{u as _,g as w}from"./aplication-D-9Si2EU.js";import{c as k}from"./filters-DOZi4c6H.js";import{g as D}from"./vacancy-B2n0AnwW.js";import{D as S}from"./DataTable-DTdJEoNs.js";import{I as C,_ as A,c as l,a as i,b as I,e as c,t as m,w as g,r as p,n as V,F as b,i as v,o as d}from"./index-BBRSQRce.js";import"./http-C1CqThx4.js";import"./conversors-BXIEm-hF.js";import"./SearchInput-Dz10qtPx.js";import"./MyButton-CPGQxF9f.js";const B={name:"AplicationsVacancy",components:{DataTable:S,Icon:C},data(){return{openDropdownItem:null,dropdownStyles:{position:"absolute",top:"0px",left:"0px"},vaga:{},items:[],columns:[{key:"person.name",title:"Nome"},{key:"person.email",title:"Email"},{key:"status",title:"Estado"},{key:"createdAt",title:"Criado em",type:"date"}],aplicationStatus:[],loading:!1,total:0,page:1,search:""}},mounted(){this.getAplicationsByVacancy(),this.getVacancyDetail(),this.getAplicationStatus(),document.addEventListener("click",this.handleClickOutside)},beforeUnmount(){document.removeEventListener("click",this.handleClickOutside)},methods:{async getAplicationStatus(){try{const t=await k();this.aplicationStatus=t.data}catch(t){this.$snotify.error(t)}},async getAplicationsByVacancy(){this.loading=!0;try{const t=await w(this.$route.params.id,this.filters);this.items.push(...t.data.data),this.total=t.data.meta.totalPages}catch(t){this.$snotify.error(t)}finally{this.loading=!1}},async getVacancyDetail(){this.loading=!0;try{const t=await D(this.$route.params.id);this.vaga=t.data}catch(t){this.$snotify.error(t)}finally{this.loading=!1}},handleLoadMore(){this.page++,this.getAplicationsByVacancy()},handleSearch(t){this.search=t,this.page=1,this.items=[],this.getAplicationsByVacancy()},async handleToggleStatus(t,a){this.loading=!0;const e={...t};try{e.status=a,delete e.id,delete e.updatedAt,delete e.createdAt,delete e.vacancy,delete e.person,await _(t.id,e),this.$snotify.success("Candidatura atualizada com sucesso!"),t.status=a}catch(r){this.$snotify.error("Erro ao atualizar candidatura: "+r)}finally{this.openDropdownItem=null,this.loading=!1}},toggleDropdown(t,a){const e=t.target.getBoundingClientRect();if(this.openDropdownItem===a){this.openDropdownItem=null;return}this.openDropdownItem=a,this.dropdownStyles={position:"absolute",top:`${e.bottom+8}px`,left:`${e.left-60}px`}},handleClickOutside(t){setTimeout(()=>{const a=this.$refs.dropdown,e=t.target,r=t.target.closest(".actions");a&&!a.contains(e)&&!r&&(this.openDropdownItem=null)},0)}},computed:{filters(){return{page:this.page,search:this.search}},loadMore(){return this.page<this.total}}},L={class:"card"},x=["onClick"],M=["onClick"];function E(t,a,e,r,o,s){const u=p("Icon"),y=p("RouterLink"),f=p("DataTable");return d(),l("main",null,[i("section",L,[i("header",null,[i("h1",null,"Candidatos a vaga "+m(o.vaga.title),1)]),c(f,{items:o.items,columns:o.columns,loading:o.loading,total:o.total,loadMore:s.loadMore,onOnLoadMore:s.handleLoadMore,onOnSearch:s.handleSearch},{actions:g(({item:n})=>[i("button",{class:"rounded",onClick:h=>s.toggleDropdown(h,n),title:"Editar Status"},[c(u,{icon:"fluent:status-12-filled"})],8,x),c(y,{class:"rounded primary",to:{name:"recruiterCandidateDetail",params:{id:n.person.id}},title:"Ver Candidato",target:"_blank"},{default:g(()=>[c(u,{icon:"mdi:user"})]),_:2},1032,["to"])]),_:1},8,["items","columns","loading","total","loadMore","onOnLoadMore","onOnSearch"])]),o.openDropdownItem?(d(),l("article",{key:0,ref:"dropdown",style:V(o.dropdownStyles),class:"dropdown-status"},[i("ul",null,[(d(!0),l(b,null,v(o.aplicationStatus,n=>(d(),l("li",{key:n.id,onClick:h=>s.handleToggleStatus(o.openDropdownItem,n.value)},m(n.title),9,M))),128))])],4)):I("",!0)])}const j=A(B,[["render",E],["__scopeId","data-v-9a5e9e11"]]);export{j as default};
