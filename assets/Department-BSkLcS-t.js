import{D as k}from"./DataTable-Bm7SzrhG.js";import{_,h as C,w as d,e as n,f as g,r,a as s,g as S,o as f,I as w,t as I,c as y,F as O}from"./index-CEB7vAn4.js";import{F as B,c as A,a as E}from"./FormInput-BVIZvDQn.js";import{M as v}from"./ModalBase-Baaot0GX.js";import{M as F}from"./MyButton--PsirZKo.js";import{h as D}from"./http-BD6d8YlU.js";import{t as x}from"./conversors-aU8gtWUe.js";const T=e=>D.authApi().post("/department",e),N=e=>D.authApi().get(`/department?${x(e)}`),b=(e,t)=>D.authApi().put(`/department/${e}`,t),V=e=>D.authApi().delete(`/department/${e}`),$={name:"FormDepartmentModal",components:{ModalBase:v,FormInput:B,MyButton:F},props:{show:{type:Boolean,default:!1},dataForm:{type:Object}},emits:["onClose","onSave"],data(){return{form:{status:!1},errors:{},loading:!1}},watch:{dataForm(){this.dataForm&&(this.form={...this.form,...this.dataForm})}},methods:{validate(){A({name:E().required("Setor é obrigatório")}).validate(this.form,{abortEarly:!1}).then(()=>{this.errors={},this.saveDepartment()}).catch(t=>{const i={};t.inner.forEach(h=>{i[h.path]=h.message}),this.errors=i})},async saveDepartment(){this.loading=!0;try{const e=!!this.form.id;e&&(delete this.form.id,delete this.form.createdAt,delete this.form.updatedAt,delete this.form.deletedAt),e?await b(this.dataForm.id,this.form):await T(this.form),this.$snotify.success(`Setor ${e?"atualizado":"criado"} com sucesso`),this.$emit("onSave"),this.closeModal()}catch(e){this.$snotify.error("Erro ao salvar o setor: "+e)}finally{this.loading=!1}},closeModal(){this.form={status:!1},this.errors={},this.$emit("onClose")}}};function q(e,t,i,h,o,a){const l=r("FormInput"),u=r("MyButton"),p=r("ModalBase");return f(),C(p,{open:i.show,loading:o.loading,title:"Novo Setor",onOnClose:a.closeModal},{content:d(()=>[s("form",{onSubmit:t[1]||(t[1]=S((...m)=>a.validate&&a.validate(...m),["prevent"]))},[n(l,{label:"Setor",type:"text",placeholder:"Digite o setor",modelValue:o.form.name,"onUpdate:modelValue":t[0]||(t[0]=m=>o.form.name=m),error:o.errors.name,required:""},null,8,["modelValue","error"])],32)]),actions:d(()=>[n(u,{class:"btn success",loading:o.loading,onClick:a.validate},{default:d(()=>t[2]||(t[2]=[g(" Salvar ")])),_:1},8,["loading","onClick"])]),_:1},8,["open","loading","onOnClose"])}const z=_($,[["render",q],["__scopeId","data-v-0477a7c2"]]),L={name:"DeleteDepartmentModal",components:{ModalBase:v,Icon:w,MyButton:F},props:{show:{type:Boolean,default:!1},dataForm:{type:Object}},emits:["onClose","onConfirm"],data(){return{loading:!1}},methods:{async deleteDepartment(){this.loading=!0;try{await V(this.dataForm.id),this.$snotify.success("Setor excluído com sucesso!"),this.$emit("onConfirm"),this.$emit("onClose")}catch(e){this.$snotify.error("Erro ao excluir o setor: "+e)}finally{this.loading=!1}}}};function j(e,t,i,h,o,a){const l=r("Icon"),u=r("MyButton"),p=r("ModalBase");return f(),C(p,{open:i.show,loading:o.loading,title:"Confirmar Exclusão",onOnClose:t[0]||(t[0]=m=>e.$emit("onClose"))},{content:d(()=>[s("section",null,[n(l,{icon:"carbon:warning"}),s("div",null,[s("p",null,[t[1]||(t[1]=g(" Tem certeza que deseja excluir o setor ")),s("span",null,I(i.dataForm?.name),1),t[2]||(t[2]=g(" ? "))]),t[3]||(t[3]=s("p",null,"Essa ação não pode ser desfeita!",-1))])])]),actions:d(()=>[n(u,{class:"btn danger",loading:o.loading,onClick:a.deleteDepartment},{default:d(()=>t[4]||(t[4]=[g("Confirmar")])),_:1},8,["loading","onClick"])]),_:1},8,["open","loading"])}const P=_(L,[["render",j],["__scopeId","data-v-fa4fd001"]]),Q={name:"RecruiterDepartment",components:{DataTable:k,Icon:w,FormDepartmentModal:z,DeleteDepartmentModal:P},data(){return{showFormDepartmentModal:!1,showDeleteDepartmentModal:!1,loading:!1,columns:[{key:"name",title:"Nome"},{key:"status",title:"Status",type:"boolean"},{key:"createdAt",title:"Criado em",type:"date"}],items:[],editItem:{},total:0,page:1,search:""}},mounted(){this.getDepartments()},methods:{refresh(){this.items=[],this.getDepartments()},async getDepartments(){this.closeAllModals(),this.loading=!0;try{const e=await N(this.filters);this.items.push(...e.data),this.total=e.data.total}catch(e){this.$snotify.error("Erro ao buscar os setor: "+e)}finally{this.loading=!1}},async handleToggleDepartment(e){this.loading=!0;try{e.status=!e.status,await b(e.id,{status:e.status}),this.$snotify.success("Setor atualizado com sucesso!")}catch(t){this.$snotify.error("Erro ao atualizar o setor: "+t),e.status=!e.status}finally{this.loading=!1}},handleSearch(e){this.search=e,this.page=1,this.items=[],this.getDepartments()},handleNewDepartment(){this.editItem={},this.showFormDepartmentModal=!0},handleEditDepartment(e){this.editItem=e,this.showFormDepartmentModal=!0},handleConfirmDelete(e){this.editItem=e,this.showDeleteDepartmentModal=!0},closeAllModals(){this.editItem={},this.showFormDepartmentModal=!1,this.showDeleteDepartmentModal=!1},handleLoadMore(){this.page+=1,this.getDepartments()}},computed:{filters(){return{page:this.page,filter:this.search}},loadMore(){return this.items.length<this.total}}},R={class:"card"},U=["onClick"],G=["onClick"],H=["onClick"],J=["onClick"];function K(e,t,i,h,o,a){const l=r("Icon"),u=r("DataTable"),p=r("FormDepartmentModal"),m=r("DeleteDepartmentModal");return f(),y(O,null,[s("main",null,[s("section",R,[s("header",null,[t[1]||(t[1]=s("h1",null,"Setores",-1)),s("button",{class:"rounded",onClick:t[0]||(t[0]=c=>o.showFormDepartmentModal=!0),title:"Novo Setor"},[n(l,{icon:"qlementine-icons:new-16"})])]),n(u,{items:o.items,columns:o.columns,loading:o.loading,total:o.total,loadMore:a.loadMore,onOnLoadMore:a.handleLoadMore,onOnSearch:a.handleSearch},{actions:d(({item:c})=>[c.status?(f(),y("button",{key:0,class:"rounded warning",onClick:M=>a.handleToggleDepartment(c),title:"Pausar"},[n(l,{icon:"ic:round-pause"})],8,U)):(f(),y("button",{key:1,class:"rounded primary",onClick:M=>a.handleToggleDepartment(c),title:"Ativar"},[n(l,{icon:"ic:round-play-arrow"})],8,G)),s("button",{class:"rounded success",onClick:M=>a.handleEditDepartment(c)},[n(l,{icon:"carbon:edit"})],8,H),s("button",{class:"rounded danger",onClick:M=>a.handleConfirmDelete(c)},[n(l,{icon:"carbon:trash-can"})],8,J)]),_:1},8,["items","columns","loading","total","loadMore","onOnLoadMore","onOnSearch"])])]),n(p,{show:o.showFormDepartmentModal,dataForm:o.editItem,onOnClose:a.closeAllModals,onOnSave:a.refresh},null,8,["show","dataForm","onOnClose","onOnSave"]),n(m,{show:o.showDeleteDepartmentModal,dataForm:o.editItem,onOnClose:a.closeAllModals,onOnConfirm:a.refresh},null,8,["show","dataForm","onOnClose","onOnConfirm"])],64)}const ae=_(Q,[["render",K],["__scopeId","data-v-7d8dc8a1"]]);export{ae as default};
