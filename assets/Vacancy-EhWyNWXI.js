import{D as M}from"./DataTable-t-TnjhHE.js";import{I as V,_ as C,h as w,w as m,e as s,f,r as u,a as o,t as _,o as d,c as p,b as D,n as k,F as b,i as v,T as S}from"./index-6U5DvoG4.js";import{r as I,u as x,l as E}from"./vacancy-DHjj5IAJ.js";import{g as B}from"./filters-DYhjAexi.js";import{M as T}from"./ModalBase-BnuH_2Fl.js";import{M as O}from"./MyButton-BYX1gFvO.js";import"./SearchInput-CeBoeNkG.js";import"./conversors-DLOhcvO0.js";import"./http-C2DCJvKC.js";const F={name:"DeleteVacancyModal",components:{ModalBase:T,Icon:V,MyButton:O},props:{show:{type:Boolean,default:!1},dataForm:{type:Object}},emits:["onClose","onConfirm"],data(){return{loading:!1}},methods:{async deleteVacancy(){this.loading=!0;try{await I(this.dataForm.id),this.$snotify.success("Vaga excluída com sucesso!"),this.$emit("onConfirm"),this.$emit("onClose")}catch(e){this.$snotify.error("Erro ao excluir a vaga: "+e)}finally{this.loading=!1}}}};function A(e,t,l,h,a,n){const i=u("Icon"),y=u("MyButton"),g=u("ModalBase");return d(),w(g,{open:l.show,loading:a.loading,title:"Confirmar Exclusão",onOnClose:t[0]||(t[0]=c=>e.$emit("onClose"))},{content:m(()=>[o("section",null,[s(i,{icon:"carbon:warning"}),o("div",null,[o("p",null,[t[1]||(t[1]=f(" Tem certeza que deseja excluir a vaga ")),o("span",null,_(l.dataForm?.title),1),t[2]||(t[2]=f(" ? "))]),t[3]||(t[3]=o("p",null,"Essa ação não pode ser desfeita!",-1))])])]),actions:m(()=>[s(y,{class:"btn danger",loading:a.loading,onClick:n.deleteVacancy},{default:m(()=>t[4]||(t[4]=[f("Confirmar")])),_:1},8,["loading","onClick"])]),_:1},8,["open","loading"])}const $=C(F,[["render",A],["__scopeId","data-v-e1b7b5e3"]]),L={name:"RecruiterVacancy",components:{DataTable:M,DeleteVacancyModal:$,Icon:V},data(){return{openDropdownId:null,dropdownStyles:{position:"absolute",top:"0px",left:"0px"},showDeleteVacancyModal:!1,loading:!1,columns:[{key:"title",title:"Título"},{key:"employmentType",title:"Tipo de vaga"},{key:"status",title:"Status"},{key:"expirationDate",title:"Data de Expiração",type:"date"}],items:[],editItem:{},vacancyStatus:[],total:0,page:1,search:""}},mounted(){this.getVacancies(),this.getVacancyStatus()},methods:{refresh(){this.items=[],this.getVacancies()},async getVacancyStatus(){try{const e=await B();this.vacancyStatus=e.data}catch(e){this.$snotify.error("Erro ao carregar status de vagas: "+e)}},async getVacancies(){this.closeAllModals(),this.loading=!0;try{const e=await E(this.filters);this.items.push(...e.data.vacancies),this.total=e.total}catch(e){this.$snotify.error(e)}finally{this.loading=!1}},handleSearch(e){this.search=e,this.page=1,this.items=[],this.getVacancies()},handleConfirmDelete(e){this.editItem=e,this.showDeleteVacancyModal=!0},closeAllModals(){this.editItem={},this.showDeleteVacancyModal=!1},handleLoadMore(){this.page++,this.getVacancies()},async handleToggleVacancy(e,t){this.loading=!0;const l=e.status;try{e.status=t;const h=e.id;delete e.id,delete e.slug,delete e.createdAt,delete e.updatedAt,delete e.deletedAt,await x(h,e),this.$snotify.success("Vaga atualizada com sucesso!")}catch(h){this.$snotify.error("Erro ao atualizar a vaga: "+h),e.status=l}finally{this.openDropdownId=null,this.loading=!1}},toggleDropdown(e,t){const l=e.target.getBoundingClientRect();this.dropdownStyles={position:"absolute",top:`${l.bottom+window.scrollY+10}px`,left:`${l.left+window.scrollX-30}px`},this.openDropdownId=this.openDropdownId===t?null:t},handleEditVacancy(e){this.$router.push({name:"recruiterVacancyForm",params:{id:e.id}})}},computed:{filters(){return{page:this.page,search:this.search}},loadMore(){return this.items.length<this.total}}},N={class:"card"},z=["onClick"],j=["onClick"],q=["onClick"],R=["onClick"],X=["onClick"];function Y(e,t,l,h,a,n){const i=u("Icon"),y=u("DataTable"),g=u("DeleteVacancyModal");return d(),p("main",null,[o("section",N,[o("header",null,[t[1]||(t[1]=o("h1",null,"Vagas",-1)),o("button",{class:"rounded",onClick:t[0]||(t[0]=()=>e.$router.push({name:"recruiterVacancyForm"})),title:"Nova Vaga"},[s(i,{icon:"qlementine-icons:new-16"})])]),s(y,{items:a.items,columns:a.columns,loading:a.loading,total:a.total,loadMore:n.loadMore,onOnLoadMore:n.handleLoadMore,onOnSearch:n.handleSearch},{actions:m(({item:c})=>[o("button",{class:"rounded",onClick:r=>n.toggleDropdown(r,c.id),title:"Editar Status"},[s(i,{icon:"fluent:status-12-filled"})],8,z),o("button",{class:"rounded primary",onClick:r=>e.$router.push({name:"recruiterVacancyDetail",params:{id:c.id}}),title:"Ver Candidatos"},[s(i,{icon:"mdi:user"})],8,j),o("button",{class:"rounded success",onClick:r=>n.handleEditVacancy(c),title:"Editar"},[s(i,{icon:"carbon:edit"})],8,q),o("button",{class:"rounded danger",onClick:r=>n.handleConfirmDelete(c),title:"Excluir"},[s(i,{icon:"carbon:trash-can"})],8,R),(d(),w(S,{to:"body"},[a.openDropdownId===c.id?(d(),p("article",{key:0,style:k(a.dropdownStyles)},[o("ul",null,[(d(!0),p(b,null,v(a.vacancyStatus,r=>(d(),p("li",{onClick:G=>n.handleToggleVacancy(c,r.title),key:r.id},_(r.title),9,X))),128))])],4)):D("",!0)]))]),_:1},8,["items","columns","loading","total","loadMore","onOnLoadMore","onOnSearch"])]),s(g,{show:a.showDeleteVacancyModal,dataForm:a.editItem,onOnClose:n.closeAllModals,onOnConfirm:n.refresh},null,8,["show","dataForm","onOnClose","onOnConfirm"])])}const te=C(L,[["render",Y],["__scopeId","data-v-4d9e6535"]]);export{te as default};
