import{D as b}from"./DataTable-tWmVsIQD.js";import{_ as S,h as w,w as m,e as a,f,r as i,a as t,g as I,o as M,I as C,t as D,c as O,F as B}from"./index-S2YWwiI0.js";import{h as v,F as E,c as k,a as p}from"./http-zF2HLkK1.js";import{t as x,M as _}from"./ModalBase-Clh2595y.js";import{M as y}from"./MyButton-fnZB6PDp.js";const V=e=>v.authApi().post("/user",e),A=e=>v.authApi().get(`/user?${x(e)}`),N=(e,o)=>v.authApi().put(`/user/${e}`,o),q=e=>v.authApi().delete(`/user/${e}`),T={name:"FormSupervisorModal",components:{ModalBase:_,FormInput:E,MyButton:y},props:{show:{type:Boolean,default:!1},dataForm:{type:Object}},emits:["onClose","onSave"],data(){return{form:{permissionId:2},errors:{},loading:!1}},watch:{dataForm(){console.log("form",this.form),this.dataForm&&(this.form={...this.form,...this.dataForm})}},methods:{validate(){k({name:p().required("Nome é obrigatório"),email:p().email("E-mail inválido").required("E-mail é obrigatório"),password:this.form.id?p().min(6,"Senha deve ter pelo menos 6 caracteres"):p().min(6,"Senha deve ter pelo menos 6 caracteres").required("Senha é obrigatória")}).validate(this.form,{abortEarly:!1}).then(()=>{this.errors={},this.saveSupervisor()}).catch(o=>{const d={};o.inner.forEach(u=>{d[u.path]=u.message}),this.errors=d})},async saveSupervisor(){this.loading=!0;try{const e=!!this.form.id;e&&(delete this.form.id,delete this.form.createdAt,delete this.form.updatedAt),e&&!this.form.password&&delete this.form.password,e?await N(this.dataForm.id,this.form):await V(this.form),this.$snotify.success(`Supervisor ${e?"atualizado":"criado"} com sucesso`),this.$emit("onSave"),this.closeModal()}catch(e){this.$snotify.error("Erro ao salvar o supervisor: "+e)}finally{this.loading=!1}},closeModal(){this.form={permissionId:2},this.errors={},this.$emit("onClose")}}};function L(e,o,d,u,s,r){const l=i("FormInput"),c=i("MyButton"),h=i("ModalBase");return M(),w(h,{open:d.show,loading:s.loading,title:"Novo Supervisor",onOnClose:r.closeModal},{content:m(()=>[t("form",{onSubmit:o[3]||(o[3]=I((...n)=>r.validate&&r.validate(...n),["prevent"]))},[a(l,{label:"Nome",type:"text",placeholder:"Digite o nome",modelValue:s.form.name,"onUpdate:modelValue":o[0]||(o[0]=n=>s.form.name=n),error:s.errors.name,required:""},null,8,["modelValue","error"]),a(l,{label:"E-mail",type:"email",placeholder:"Digite o e-mail",modelValue:s.form.email,"onUpdate:modelValue":o[1]||(o[1]=n=>s.form.email=n),error:s.errors.email,required:""},null,8,["modelValue","error"]),a(l,{label:"Senha",type:"password",placeholder:"Digite a senha",modelValue:s.form.password,"onUpdate:modelValue":o[2]||(o[2]=n=>s.form.password=n),error:s.errors.password,required:""},null,8,["modelValue","error"])],32)]),actions:m(()=>[a(c,{class:"btn success",loading:s.loading,onClick:r.validate},{default:m(()=>o[4]||(o[4]=[f(" Salvar ")])),_:1},8,["loading","onClick"])]),_:1},8,["open","loading","onOnClose"])}const j=S(T,[["render",L],["__scopeId","data-v-e15cf4e3"]]),U={name:"DeleteSupervisorModal",components:{ModalBase:_,Icon:C,MyButton:y},props:{show:{type:Boolean,default:!1},dataForm:{type:Object}},emits:["onClose","onConfirm"],data(){return{loading:!1}},methods:{async deleteSupervisor(){this.loading=!0;try{await q(this.dataForm.id),this.$snotify.success("Supervisor excluído com sucesso!"),this.$emit("onConfirm"),this.$emit("onClose")}catch(e){this.$snotify.error("Erro ao excluir o supervisor: "+e)}finally{this.loading=!1}}}};function z(e,o,d,u,s,r){const l=i("Icon"),c=i("MyButton"),h=i("ModalBase");return M(),w(h,{open:d.show,loading:s.loading,title:"Confirmar Exclusão",onOnClose:o[0]||(o[0]=n=>e.$emit("onClose"))},{content:m(()=>[t("section",null,[a(l,{icon:"carbon:warning"}),t("div",null,[t("p",null,[o[1]||(o[1]=f(" Tem certeza que deseja excluir o surpevisor ")),t("span",null,D(d.dataForm?.name),1),o[2]||(o[2]=f(" ? "))]),o[3]||(o[3]=t("p",null,"Essa ação não pode ser desfeita!",-1))])])]),actions:m(()=>[a(c,{class:"btn danger",loading:s.loading,onClick:r.deleteSupervisor},{default:m(()=>o[4]||(o[4]=[f("Confirmar")])),_:1},8,["loading","onClick"])]),_:1},8,["open","loading"])}const Q=S(U,[["render",z],["__scopeId","data-v-07a28dcf"]]),G={name:"SupervisorController",components:{DataTable:b,Icon:C,FormSupervisorModal:j,DeleteSupervisorModal:Q},data(){return{showDeleteSupervisorModal:!1,showFormSupervisorModal:!1,loading:!1,columns:[{key:"name",title:"Nome"},{key:"email",title:"Email"},{key:"created",title:"Criado em"}],items:[],editItem:{},total:0,page:1,search:""}},mounted(){this.getSupervisors()},methods:{refresh(){this.items=[],this.getSupervisors()},async getSupervisors(){this.closeAllModals(),this.loading=!0;try{const e=await A(this.filters);this.items.push(...e.data.data),this.total=e.data.total}catch(e){this.$snotify.error("Erro ao buscar os recrutadores: "+e)}finally{this.loading=!1}},handleSearch(e){this.search=e,this.page=1,this.items=[],this.getSupervisors()},handleNewSupervisor(){this.editItem={},this.showFormSupervisorModal=!0},handleEditSupervisor(e){this.editItem=e,this.showFormSupervisorModal=!0},handleConfirmDelete(e){this.editItem=e,this.showDeleteSupervisorModal=!0},closeAllModals(){this.editItem={},this.showFormSupervisorModal=!1,this.showDeleteSupervisorModal=!1},handleLoadMore(){this.page+=1,this.getSupervisors()}},computed:{filters(){return{page:this.page,filter:this.search}},loadMore(){return this.items.length<this.total}}},H={class:"card"},J=["onClick"],K=["onClick"];function P(e,o,d,u,s,r){const l=i("Icon"),c=i("DataTable"),h=i("FormSupervisorModal"),n=i("DeleteSupervisorModal");return M(),O(B,null,[t("main",null,[t("section",H,[t("header",null,[o[1]||(o[1]=t("h1",null,"Supervisores",-1)),t("button",{class:"rounded",onClick:o[0]||(o[0]=g=>s.showFormSupervisorModal=!0)},[a(l,{icon:"tdesign:user-add"})])]),a(c,{items:s.items,columns:s.columns,loading:s.loading,total:s.total,loadMore:r.loadMore,onOnLoadMore:r.handleLoadMore,onOnSearch:r.handleSearch},{actions:m(({item:g})=>[t("button",{class:"rounded success",onClick:F=>r.handleEditSupervisor(g)},[a(l,{icon:"carbon:edit"})],8,J),t("button",{class:"rounded danger",onClick:F=>r.handleConfirmDelete(g)},[a(l,{icon:"carbon:trash-can"})],8,K)]),_:1},8,["items","columns","loading","total","loadMore","onOnLoadMore","onOnSearch"])])]),a(h,{show:s.showFormSupervisorModal,dataForm:s.editItem,onOnClose:r.closeAllModals,onOnSave:r.refresh},null,8,["show","dataForm","onOnClose","onOnSave"]),a(n,{show:s.showDeleteSupervisorModal,dataForm:s.editItem,onOnClose:r.closeAllModals,onOnConfirm:r.getSupervisors},null,8,["show","dataForm","onOnClose","onOnConfirm"])],64)}const $=S(G,[["render",P],["__scopeId","data-v-fa3d0338"]]);export{$ as default};
