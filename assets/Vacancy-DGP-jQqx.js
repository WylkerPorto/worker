import{D as b}from"./DataTable-DZolE3ng.js";import{I as k,_ as D,g as v,w as c,e as s,f as y,r as d,a as l,t as w,o as u,c as g,d as S,F as V,i as _,n as x}from"./index-Mu0760Vm.js";import{r as B,c as E,u as O,l as F}from"./vacancy-BAPdMDMv.js";import{g as T}from"./filters-BMeN6P-b.js";import{M as P}from"./ModalBase-Bwp8s5BC.js";import{M as I}from"./MyButton-CAWIgk02.js";import"./SearchInput-B9aETNtM.js";import"./conversors-CKfFtFQ4.js";import"./http-CXuHNYXv.js";const L={name:"DeleteVacancyModal",components:{ModalBase:P,Icon:k,MyButton:I},props:{show:{type:Boolean,default:!1},dataForm:{type:Object}},emits:["onClose","onConfirm"],data(){return{loading:!1}},methods:{async deleteVacancy(){this.loading=!0;try{await B(this.dataForm.id),this.$snotify.success("Vaga excluída com sucesso!"),this.$emit("onConfirm"),this.$emit("onClose")}catch(t){this.$snotify.error("Erro ao excluir a vaga: "+t)}finally{this.loading=!1}}}};function A(t,e,a,m,o,i){const r=d("Icon"),f=d("MyButton"),h=d("ModalBase");return u(),v(h,{open:a.show,loading:o.loading,title:"Confirmar Exclusão",onOnClose:e[0]||(e[0]=C=>t.$emit("onClose"))},{content:c(()=>[l("section",null,[s(r,{icon:"carbon:warning"}),l("div",null,[l("p",null,[e[1]||(e[1]=y(" Tem certeza que deseja excluir a vaga ")),l("span",null,w(a.dataForm?.title),1),e[2]||(e[2]=y(" ? "))]),e[3]||(e[3]=l("p",null,"Essa ação não pode ser desfeita!",-1))])])]),actions:c(()=>[s(f,{class:"btn danger",loading:o.loading,onClick:i.deleteVacancy},{default:c(()=>e[4]||(e[4]=[y("Confirmar")])),_:1},8,["loading","onClick"])]),_:1},8,["open","loading"])}const N=D(L,[["render",A],["__scopeId","data-v-e1b7b5e3"]]),z={name:"RecruiterVacancy",components:{DataTable:b,DeleteVacancyModal:N,Icon:k,MyButton:I},data(){return{openDropdownItem:null,dropdownStyles:{position:"absolute",top:"0px",left:"0px"},showDeleteVacancyModal:!1,loading:!1,columns:[{key:"title",title:"Título"},{key:"employmentType",title:"Tipo de vaga"},{key:"status",title:"Status"},{key:"expirationDate",title:"Data de Expiração",type:"date"}],items:[],editItem:{},vacancyStatus:[],total:0,page:1,totalPage:0,search:"",status:"Ativa"}},mounted(){this.getVacancies(),this.getVacancyStatus(),document.addEventListener("click",this.handleClickOutside)},beforeUnmount(){document.removeEventListener("click",this.handleClickOutside)},methods:{refresh(){this.items=[],this.getVacancies()},async getVacancyStatus(){try{const t=await T();this.vacancyStatus=t.data}catch(t){this.$snotify.error("Erro ao carregar status de vagas: "+t)}},async getVacancies(){this.closeAllModals(),this.loading=!0;try{const{data:t}=await F(this.filters);this.items=t.vacancies,this.total=t.total,this.totalPage=Math.ceil(t.total/t.rows)}catch(t){this.$snotify.error(t)}finally{this.loading=!1}},handleSearch(t){this.search=t,this.page=1,this.items=[],this.getVacancies()},handleConfirmDelete(t){this.editItem=t,this.showDeleteVacancyModal=!0},closeAllModals(){this.editItem={},this.showDeleteVacancyModal=!1},handleLoadMore(t){this.page+=t,this.getVacancies()},async handleToggleVacancy(t,e){this.loading=!0;const a={...t};try{a.status=e,delete a.id,delete a.slug,delete a.createdAt,delete a.position,delete a.department,await O(t.id,a),this.$snotify.success("Vaga atualizada com sucesso!"),this.refresh()}catch(m){this.$snotify.error("Erro ao atualizar a vaga: "+m)}finally{this.openDropdownItem=null,this.loading=!1}},toggleDropdown(t,e){const a=t.target.getBoundingClientRect();if(this.openDropdownItem===e){this.openDropdownItem=null;return}this.dropdownStyles={position:"absolute",top:`${a.bottom+window.scrollY+10}px`,left:`${a.left+window.scrollX-30}px`},this.openDropdownItem=e},handleClickOutside(t){setTimeout(()=>{const e=this.$refs.dropdown,a=t.target,m=t.target.closest(".actions");e&&!e.contains(a)&&!m&&(this.openDropdownItem=null)},0)},async handleCloneVacancy(t){this.loading=!0;const e={...t};try{e.title+="-copia",e.departmentId=t.department.id,e.positionId=t.position.id,delete e.id,delete e.slug,delete e.createdAt,delete e.position,delete e.department,await E(e),this.$snotify.success("Vaga duplicada com sucesso!"),this.refresh()}catch(a){this.$snotify.error("Erro ao duplicar a vaga: "+a)}finally{this.loading=!1}},handleChangeFilter(t){this.status=t,this.page=1,this.items=[],this.getVacancies()}},computed:{filters(){return{page:this.page,search:this.search,status:this.status}}}},R={class:"card"},$={class:"filters"},j=["onClick"],q=["onClick"],U=["onClick"],X=["onClick"];function Y(t,e,a,m,o,i){const r=d("Icon"),f=d("MyButton"),h=d("RouterLink"),C=d("DataTable"),M=d("DeleteVacancyModal");return u(),g("main",null,[l("section",R,[l("header",null,[e[3]||(e[3]=l("h1",null,"Vagas",-1)),l("button",{class:"rounded",onClick:e[0]||(e[0]=()=>t.$router.push({name:"recruiterVacancyForm"})),title:"Nova Vaga"},[s(r,{icon:"qlementine-icons:new-16"})])]),l("div",$,[(u(!0),g(V,null,_(o.vacancyStatus,n=>(u(),v(f,{class:"btn primary",key:n.id,onClick:p=>i.handleChangeFilter(n.title)},{default:c(()=>[y(w(n.title)+"s ",1)]),_:2},1032,["onClick"]))),128))]),s(C,{items:o.items,columns:o.columns,loading:o.loading,totalItems:o.total,totalPage:o.totalPage,currentPage:o.page,onOnSearch:i.handleSearch,onOnNextPage:e[1]||(e[1]=n=>i.handleLoadMore(1)),onOnPreviousPage:e[2]||(e[2]=n=>i.handleLoadMore(-1))},{actions:c(({item:n})=>[l("button",{class:"rounded",onClick:p=>i.toggleDropdown(p,n),title:"Editar Status"},[s(r,{icon:"fluent:status-12-filled"})],8,j),s(h,{class:"rounded primary",to:{name:"jobDetail",params:{slug:n.slug}},target:"_blank",title:"Compartilhar Vaga"},{default:c(()=>[s(r,{icon:"mdi:share"})]),_:2},1032,["to"]),s(h,{class:"rounded warning",to:{name:"recruiterVacancyDetail",params:{id:n.id}},title:"Ver Candidatos"},{default:c(()=>[s(r,{icon:"mdi:user"})]),_:2},1032,["to"]),l("button",{class:"rounded light",onClick:p=>i.handleCloneVacancy(n),title:"Duplicar"},[s(r,{icon:"zondicons:duplicate"})],8,q),s(h,{class:"rounded success",to:{name:"recruiterVacancyForm",params:{id:n.id}},title:"Editar"},{default:c(()=>[s(r,{icon:"carbon:edit"})]),_:2},1032,["to"]),l("button",{class:"rounded danger",onClick:p=>i.handleConfirmDelete(n),title:"Excluir"},[s(r,{icon:"carbon:trash-can"})],8,U)]),_:1},8,["items","columns","loading","totalItems","totalPage","currentPage","onOnSearch"])]),o.openDropdownItem?(u(),g("article",{key:0,ref:"dropdown",style:x(o.dropdownStyles),class:"dropdown-status"},[l("ul",null,[(u(!0),g(V,null,_(o.vacancyStatus,n=>(u(),g("li",{key:n.id,onClick:p=>i.handleToggleVacancy(o.openDropdownItem,n.title)},w(n.title),9,X))),128))])],4)):S("",!0),s(M,{show:o.showDeleteVacancyModal,dataForm:o.editItem,onOnClose:i.closeAllModals,onOnConfirm:i.refresh},null,8,["show","dataForm","onOnClose","onOnConfirm"])])}const ae=D(z,[["render",Y],["__scopeId","data-v-93381d7a"]]);export{ae as default};
