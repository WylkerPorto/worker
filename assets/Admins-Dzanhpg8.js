import{t as b,M as _,D as I}from"./ModalBase-zXj2vIJ8.js";import{_ as M,h as y,w as m,e as a,f as p,r,b as n,g as D,o as w,I as C,t as B,c as E,F as S}from"./index-CTAu206E.js";import{M as v,F as k,c as O,a as f}from"./MyButton-Duzzu9Kp.js";import{h as g}from"./http-BD6d8YlU.js";const x=e=>g.authApi().post("/user",e),V=e=>g.authApi().get(`/user?${b(e)}`),q=(e,o)=>g.authApi().put(`/user/${e}`,o),N=e=>g.authApi().delete(`/user/${e}`),T={name:"FormAdminModal",components:{ModalBase:_,FormInput:k,MyButton:v},props:{show:{type:Boolean,default:!1},dataForm:{type:Object}},emits:["onClose","onSave"],data(){return{form:{permission_id:0},errors:{},loading:!1}},watch:{dataForm(){this.dataForm&&(this.form={...this.form,...this.dataForm})}},methods:{validate(){O({name:f().required("Nome é obrigatório"),email:f().email("E-mail inválido").required("E-mail é obrigatório"),password:this.form.id?f().min(6,"Senha deve ter pelo menos 6 caracteres").notRequired():f().min(6,"Senha deve ter pelo menos 6 caracteres").required("Senha é obrigatória")}).validate(this.form,{abortEarly:!1}).then(()=>{this.errors={},this.saveAdmin()}).catch(o=>{const d={};o.inner.forEach(c=>{d[c.path]=c.message}),this.errors=d})},async saveAdmin(){this.loading=!0;try{const e=!!this.form.id;e&&(delete this.form.id,delete this.form.createdAt,delete this.form.updatedAt),e&&!this.form.password&&delete this.form.password,console.log("this.form",this.form),e?await q(this.dataForm.id,this.form):await x(this.form),this.$snotify.success(`Administrador ${e?"atualizado":"salvo"} com sucesso!`),this.$emit("onSave"),this.closeModal()}catch(e){this.$snotify.error("Erro ao salvar o administrador: "+e)}finally{this.loading=!1}},closeModal(){this.form={permission_id:0},this.errors={},this.$emit("onClose")}}};function j(e,o,d,c,t,s){const l=r("FormInput"),h=r("MyButton"),u=r("ModalBase");return w(),y(u,{open:d.show,loading:t.loading,title:"Novo Administrador",onOnClose:s.closeModal},{content:m(()=>[n("form",{onSubmit:o[3]||(o[3]=D((...i)=>s.validate&&s.validate(...i),["prevent"]))},[a(l,{label:"Nome",type:"text",placeholder:"Digite o nome",modelValue:t.form.name,"onUpdate:modelValue":o[0]||(o[0]=i=>t.form.name=i),error:t.errors.name,required:""},null,8,["modelValue","error"]),a(l,{label:"E-mail",type:"email",placeholder:"Digite o e-mail",modelValue:t.form.email,"onUpdate:modelValue":o[1]||(o[1]=i=>t.form.email=i),error:t.errors.email,required:""},null,8,["modelValue","error"]),a(l,{label:"Senha",type:"password",placeholder:"Digite a senha",modelValue:t.form.password,"onUpdate:modelValue":o[2]||(o[2]=i=>t.form.password=i),error:t.errors.password,required:""},null,8,["modelValue","error"])],32)]),actions:m(()=>[a(h,{class:"btn success",loading:t.loading,onClick:s.validate},{default:m(()=>o[4]||(o[4]=[p(" Salvar ")])),_:1},8,["loading","onClick"])]),_:1},8,["open","loading","onOnClose"])}const U=M(T,[["render",j],["__scopeId","data-v-ebf5450a"]]),z={name:"DeleteAdminModal",components:{ModalBase:_,Icon:C,MyButton:v},props:{show:{type:Boolean,default:!1},dataForm:{type:Object}},emits:["onClose","onConfirm"],data(){return{loading:!1}},methods:{async deleteAdmin(){this.loading=!0;try{await N(this.dataForm.id),this.$snotify.success("Administrador excluído com sucesso!"),this.$emit("onConfirm"),this.$emit("onClose")}catch(e){this.$snotify.error("Erro ao excluir o administrador: "+e)}finally{this.loading=!1}}}};function Q(e,o,d,c,t,s){const l=r("Icon"),h=r("MyButton"),u=r("ModalBase");return w(),y(u,{open:d.show,loading:t.loading,title:"Confirmar Exclusão",onOnClose:o[0]||(o[0]=i=>e.$emit("onClose"))},{content:m(()=>[n("section",null,[a(l,{icon:"carbon:warning"}),n("div",null,[n("p",null,[o[1]||(o[1]=p(" Tem certeza que deseja excluir o administrador ")),n("span",null,B(d.dataForm?.name),1),o[2]||(o[2]=p(" ? "))]),o[3]||(o[3]=n("p",null,"Essa ação não pode ser desfeita!",-1))])])]),actions:m(()=>[a(h,{class:"btn danger",loading:t.loading,onClick:s.deleteAdmin},{default:m(()=>o[4]||(o[4]=[p("Confirmar")])),_:1},8,["loading","onClick"])]),_:1},8,["open","loading"])}const R=M(z,[["render",Q],["__scopeId","data-v-34a7eccb"]]),G={name:"AdminController",components:{DataTable:I,Icon:C,FormAdminModal:U,DeleteAdminModal:R},data(){return{showFormAdminModal:!1,showDeleteAdminModal:!1,loading:!1,columns:[{title:"Nome",key:"name"},{title:"Email",key:"email"},{title:"Criado",key:"createdAt",type:"date"}],items:[],editItem:{},total:0,page:1,limit:10,search:""}},mounted(){this.getAdmins()},methods:{async getAdmins(){this.closeAllModals(),this.loading=!0;try{const e=await V(this.filters);this.items=e.data.data,this.total=e.data.total}catch(e){this.$snotify.error("Erro ao buscar os administradores: "+e)}finally{this.loading=!1}},handleSearch(e){this.search=e,this.page=1,this.getAdmins()},handleNewAdmin(){this.editItem={},this.showFormAdminModal=!0},handleEditAdmin(e){this.editItem=e,this.showFormAdminModal=!0},handleConfirmDelete(e){this.editItem=e,this.showDeleteAdminModal=!0},closeAllModals(){this.editItem={},this.showFormAdminModal=!1,this.showDeleteAdminModal=!1}},computed:{filters(){return{page:this.page,filter:this.search}}}},H={class:"card"},J=["onClick"],K=["onClick"];function L(e,o,d,c,t,s){const l=r("Icon"),h=r("DataTable"),u=r("FormAdminModal"),i=r("DeleteAdminModal");return w(),E(S,null,[n("main",null,[n("section",H,[n("header",null,[o[1]||(o[1]=n("h1",null,"Administradores",-1)),n("button",{class:"rounded",onClick:o[0]||(o[0]=A=>t.showFormAdminModal=!0)},[a(l,{icon:"tdesign:user-add"})])]),a(h,{items:t.items,columns:t.columns,loading:t.loading,total:t.total,onOnSearch:s.handleSearch},{actions:m(({item:A})=>[n("button",{class:"rounded success",onClick:F=>s.handleEditAdmin(A)},[a(l,{icon:"carbon:edit"})],8,J),n("button",{class:"rounded danger",onClick:F=>s.handleConfirmDelete(A)},[a(l,{icon:"carbon:trash-can"})],8,K)]),_:1},8,["items","columns","loading","total","onOnSearch"])])]),a(u,{show:t.showFormAdminModal,dataForm:t.editItem,onOnClose:s.closeAllModals,onOnSave:s.getAdmins},null,8,["show","dataForm","onOnClose","onOnSave"]),a(i,{show:t.showDeleteAdminModal,dataForm:t.editItem,onOnClose:s.closeAllModals,onOnConfirm:s.getAdmins},null,8,["show","dataForm","onOnClose","onOnConfirm"])],64)}const Z=M(G,[["render",L],["__scopeId","data-v-38e6ab9d"]]);export{Z as default};
