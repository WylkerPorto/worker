import{D as _}from"./DataTable-HmMSxI9p.js";import{I as V,_ as C,g as k,w as c,e as n,f,r as d,a as s,t as D,o as p,c as g,d as I,n as v,F as M,i as b}from"./index-CjdhjMXF.js";import{r as x,c as S,u as E,l as O}from"./vacancy-DSgO_k5_.js";import{g as B}from"./filters-CTMLUOKF.js";import{M as T}from"./ModalBase-quL0Ke7e.js";import{M as P}from"./MyButton-pt6yh-1N.js";import"./SearchInput-BYtjQ7Ns.js";import"./conversors-CBWuNu8U.js";import"./http-B6iAuTPI.js";const F={name:"DeleteVacancyModal",components:{ModalBase:T,Icon:V,MyButton:P},props:{show:{type:Boolean,default:!1},dataForm:{type:Object}},emits:["onClose","onConfirm"],data(){return{loading:!1}},methods:{async deleteVacancy(){this.loading=!0;try{await x(this.dataForm.id),this.$snotify.success("Vaga excluída com sucesso!"),this.$emit("onConfirm"),this.$emit("onClose")}catch(t){this.$snotify.error("Erro ao excluir a vaga: "+t)}finally{this.loading=!1}}}};function L(t,e,o,u,a,i){const r=d("Icon"),m=d("MyButton"),y=d("ModalBase");return p(),k(y,{open:o.show,loading:a.loading,title:"Confirmar Exclusão",onOnClose:e[0]||(e[0]=w=>t.$emit("onClose"))},{content:c(()=>[s("section",null,[n(r,{icon:"carbon:warning"}),s("div",null,[s("p",null,[e[1]||(e[1]=f(" Tem certeza que deseja excluir a vaga ")),s("span",null,D(o.dataForm?.title),1),e[2]||(e[2]=f(" ? "))]),e[3]||(e[3]=s("p",null,"Essa ação não pode ser desfeita!",-1))])])]),actions:c(()=>[n(m,{class:"btn danger",loading:a.loading,onClick:i.deleteVacancy},{default:c(()=>e[4]||(e[4]=[f("Confirmar")])),_:1},8,["loading","onClick"])]),_:1},8,["open","loading"])}const N=C(F,[["render",L],["__scopeId","data-v-e1b7b5e3"]]),z={name:"RecruiterVacancy",components:{DataTable:_,DeleteVacancyModal:N,Icon:V},data(){return{openDropdownItem:null,dropdownStyles:{position:"absolute",top:"0px",left:"0px"},showDeleteVacancyModal:!1,loading:!1,columns:[{key:"title",title:"Título"},{key:"employmentType",title:"Tipo de vaga"},{key:"status",title:"Status"},{key:"expirationDate",title:"Data de Expiração",type:"date"}],items:[],editItem:{},vacancyStatus:[],total:0,page:1,totalPage:0,search:""}},mounted(){this.getVacancies(),this.getVacancyStatus(),document.addEventListener("click",this.handleClickOutside)},beforeUnmount(){document.removeEventListener("click",this.handleClickOutside)},methods:{refresh(){this.items=[],this.getVacancies()},async getVacancyStatus(){try{const t=await B();this.vacancyStatus=t.data}catch(t){this.$snotify.error("Erro ao carregar status de vagas: "+t)}},async getVacancies(){this.closeAllModals(),this.loading=!0;try{const{data:t}=await O(this.filters);this.items=t.vacancies,this.total=t.total,this.totalPage=Math.ceil(t.total/t.rows)}catch(t){this.$snotify.error(t)}finally{this.loading=!1}},handleSearch(t){this.search=t,this.page=1,this.items=[],this.getVacancies()},handleConfirmDelete(t){this.editItem=t,this.showDeleteVacancyModal=!0},closeAllModals(){this.editItem={},this.showDeleteVacancyModal=!1},handleLoadMore(t){this.page+=t,this.getVacancies()},async handleToggleVacancy(t,e){this.loading=!0;const o={...t};try{o.status=e,delete o.id,delete o.slug,delete o.createdAt,delete o.position,delete o.department,await E(t.id,o),this.$snotify.success("Vaga atualizada com sucesso!"),this.refresh()}catch(u){this.$snotify.error("Erro ao atualizar a vaga: "+u)}finally{this.openDropdownItem=null,this.loading=!1}},toggleDropdown(t,e){const o=t.target.getBoundingClientRect();if(this.openDropdownItem===e){this.openDropdownItem=null;return}this.dropdownStyles={position:"absolute",top:`${o.bottom+window.scrollY+10}px`,left:`${o.left+window.scrollX-30}px`},this.openDropdownItem=e},handleClickOutside(t){setTimeout(()=>{const e=this.$refs.dropdown,o=t.target,u=t.target.closest(".actions");e&&!e.contains(o)&&!u&&(this.openDropdownItem=null)},0)},async handleCloneVacancy(t){this.loading=!0;const e={...t};try{e.title+="-copia",e.departmentId=t.department.id,e.positionId=t.position.id,delete e.id,delete e.slug,delete e.createdAt,delete e.position,delete e.department,await S(e),this.$snotify.success("Vaga duplicada com sucesso!"),this.refresh()}catch(o){this.$snotify.error("Erro ao duplicar a vaga: "+o)}finally{this.loading=!1}}},computed:{filters(){return{page:this.page,search:this.search}}}},A={class:"card"},$=["onClick"],R=["onClick"],j=["onClick"],q=["onClick"];function U(t,e,o,u,a,i){const r=d("Icon"),m=d("RouterLink"),y=d("DataTable"),w=d("DeleteVacancyModal");return p(),g("main",null,[s("section",A,[s("header",null,[e[3]||(e[3]=s("h1",null,"Vagas",-1)),s("button",{class:"rounded",onClick:e[0]||(e[0]=()=>t.$router.push({name:"recruiterVacancyForm"})),title:"Nova Vaga"},[n(r,{icon:"qlementine-icons:new-16"})])]),n(y,{items:a.items,columns:a.columns,loading:a.loading,totalItems:a.total,totalPage:a.totalPage,currentPage:a.page,onOnSearch:i.handleSearch,onOnNextPage:e[1]||(e[1]=l=>i.handleLoadMore(1)),onOnPreviousPage:e[2]||(e[2]=l=>i.handleLoadMore(-1))},{actions:c(({item:l})=>[s("button",{class:"rounded",onClick:h=>i.toggleDropdown(h,l),title:"Editar Status"},[n(r,{icon:"fluent:status-12-filled"})],8,$),n(m,{class:"rounded primary",to:{name:"jobDetail",params:{slug:l.slug}},target:"_blank",title:"Compartilhar Vaga"},{default:c(()=>[n(r,{icon:"mdi:share"})]),_:2},1032,["to"]),n(m,{class:"rounded warning",to:{name:"recruiterVacancyDetail",params:{id:l.id}},title:"Ver Candidatos"},{default:c(()=>[n(r,{icon:"mdi:user"})]),_:2},1032,["to"]),s("button",{class:"rounded light",onClick:h=>i.handleCloneVacancy(l),title:"Duplicar"},[n(r,{icon:"zondicons:duplicate"})],8,R),n(m,{class:"rounded success",to:{name:"recruiterVacancyForm",params:{id:l.id}},title:"Editar"},{default:c(()=>[n(r,{icon:"carbon:edit"})]),_:2},1032,["to"]),s("button",{class:"rounded danger",onClick:h=>i.handleConfirmDelete(l),title:"Excluir"},[n(r,{icon:"carbon:trash-can"})],8,j)]),_:1},8,["items","columns","loading","totalItems","totalPage","currentPage","onOnSearch"])]),a.openDropdownItem?(p(),g("article",{key:0,ref:"dropdown",style:v(a.dropdownStyles),class:"dropdown-status"},[s("ul",null,[(p(!0),g(M,null,b(a.vacancyStatus,l=>(p(),g("li",{key:l.id,onClick:h=>i.handleToggleVacancy(a.openDropdownItem,l.title)},D(l.title),9,q))),128))])],4)):I("",!0),n(w,{show:a.showDeleteVacancyModal,dataForm:a.editItem,onOnClose:i.closeAllModals,onOnConfirm:i.refresh},null,8,["show","dataForm","onOnClose","onOnConfirm"])])}const ee=C(z,[["render",U],["__scopeId","data-v-866d8e93"]]);export{ee as default};
