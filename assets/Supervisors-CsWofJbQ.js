import{D as F}from"./DataTable-lpC7ORQz.js";import{_ as g,g as M,w as m,e as a,f as v,r as n,a as t,h as b,o as S,I as w,t as I,c as D,F as O}from"./index-C0iXwPwW.js";import{F as B,c as E,a as f}from"./FormInput-C8nPIVZ6.js";import{M as C}from"./ModalBase-BKEaq8pV.js";import{M as y}from"./MyButton-8NTvTHKk.js";import{u as k,c as x,r as V,l as P}from"./supervisor-BNcckLDW.js";import"./SearchInput-wRdvrFLq.js";import"./conversors-Bxahe57Q.js";import"./http-lBh2inUk.js";const N={name:"FormSupervisorModal",components:{ModalBase:C,FormInput:B,MyButton:y},props:{show:{type:Boolean,default:!1},dataForm:{type:Object}},emits:["onClose","onSave"],data(){return{form:{permissionId:2},errors:{},loading:!1}},watch:{dataForm(){console.log("form",this.form),this.dataForm&&(this.form={...this.form,...this.dataForm})}},methods:{validate(){E({name:f().required("Nome é obrigatório"),email:f().email("E-mail inválido").required("E-mail é obrigatório"),password:this.form.id?f().min(6,"Senha deve ter pelo menos 6 caracteres"):f().min(6,"Senha deve ter pelo menos 6 caracteres").required("Senha é obrigatória")}).validate(this.form,{abortEarly:!1}).then(()=>{this.errors={},this.saveSupervisor()}).catch(e=>{const d={};e.inner.forEach(u=>{d[u.path]=u.message}),this.errors=d})},async saveSupervisor(){this.loading=!0;try{const o=!!this.form.id;o&&(delete this.form.id,delete this.form.createdAt,delete this.form.updatedAt),o&&!this.form.password&&delete this.form.password,o?await k(this.dataForm.id,this.form):await x(this.form),this.$snotify.success(`Supervisor ${o?"atualizado":"criado"} com sucesso`),this.$emit("onSave"),this.closeModal()}catch(o){this.$snotify.error("Erro ao salvar o supervisor: "+o)}finally{this.loading=!1}},closeModal(){this.form={permissionId:2},this.errors={},this.$emit("onClose")}}};function q(o,e,d,u,r,s){const l=n("FormInput"),c=n("MyButton"),p=n("ModalBase");return S(),M(p,{open:d.show,loading:r.loading,title:"Novo Supervisor",onOnClose:s.closeModal},{content:m(()=>[t("form",{onSubmit:e[3]||(e[3]=b((...i)=>s.validate&&s.validate(...i),["prevent"]))},[a(l,{label:"Nome",type:"text",placeholder:"Digite o nome",modelValue:r.form.name,"onUpdate:modelValue":e[0]||(e[0]=i=>r.form.name=i),error:r.errors.name,required:""},null,8,["modelValue","error"]),a(l,{label:"E-mail",type:"email",placeholder:"Digite o e-mail",modelValue:r.form.email,"onUpdate:modelValue":e[1]||(e[1]=i=>r.form.email=i),error:r.errors.email,required:""},null,8,["modelValue","error"]),a(l,{label:"Senha",type:"password",placeholder:"Digite a senha",modelValue:r.form.password,"onUpdate:modelValue":e[2]||(e[2]=i=>r.form.password=i),error:r.errors.password,required:""},null,8,["modelValue","error"])],32)]),actions:m(()=>[a(c,{class:"btn success",loading:r.loading,onClick:s.validate},{default:m(()=>e[4]||(e[4]=[v(" Salvar ")])),_:1},8,["loading","onClick"])]),_:1},8,["open","loading","onOnClose"])}const A=g(N,[["render",q],["__scopeId","data-v-e15cf4e3"]]),T={name:"DeleteSupervisorModal",components:{ModalBase:C,Icon:w,MyButton:y},props:{show:{type:Boolean,default:!1},dataForm:{type:Object}},emits:["onClose","onConfirm"],data(){return{loading:!1}},methods:{async deleteSupervisor(){this.loading=!0;try{await V(this.dataForm.id),this.$snotify.success("Supervisor excluído com sucesso!"),this.$emit("onConfirm"),this.$emit("onClose")}catch(o){this.$snotify.error("Erro ao excluir o supervisor: "+o)}finally{this.loading=!1}}}};function j(o,e,d,u,r,s){const l=n("Icon"),c=n("MyButton"),p=n("ModalBase");return S(),M(p,{open:d.show,loading:r.loading,title:"Confirmar Exclusão",onOnClose:e[0]||(e[0]=i=>o.$emit("onClose"))},{content:m(()=>[t("section",null,[a(l,{icon:"carbon:warning"}),t("div",null,[t("p",null,[e[1]||(e[1]=v(" Tem certeza que deseja excluir o surpevisor ")),t("span",null,I(d.dataForm?.name),1),e[2]||(e[2]=v(" ? "))]),e[3]||(e[3]=t("p",null,"Essa ação não pode ser desfeita!",-1))])])]),actions:m(()=>[a(c,{class:"btn danger",loading:r.loading,onClick:s.deleteSupervisor},{default:m(()=>e[4]||(e[4]=[v("Confirmar")])),_:1},8,["loading","onClick"])]),_:1},8,["open","loading"])}const L=g(T,[["render",j],["__scopeId","data-v-07a28dcf"]]),U={name:"SupervisorController",components:{DataTable:F,Icon:w,FormSupervisorModal:A,DeleteSupervisorModal:L},data(){return{showDeleteSupervisorModal:!1,showFormSupervisorModal:!1,loading:!1,columns:[{key:"name",title:"Nome"},{key:"email",title:"Email"},{key:"createdAt",title:"Criado em",type:"date"}],items:[],editItem:{},total:0,page:1,totalPage:0,search:""}},mounted(){this.getSupervisors()},methods:{refresh(){this.items=[],this.getSupervisors()},async getSupervisors(){this.closeAllModals(),this.loading=!0;try{const{data:o}=await P(this.filters);this.items=o.data,this.total=o.total,this.totalPage=Math.ceil(o.total/o.per_page)}catch(o){this.$snotify.error("Erro ao buscar os recrutadores: "+o)}finally{this.loading=!1}},handleSearch(o){this.search=o,this.page=1,this.items=[],this.getSupervisors()},handleNewSupervisor(){this.editItem={},this.showFormSupervisorModal=!0},handleEditSupervisor(o){this.editItem=o,this.showFormSupervisorModal=!0},handleConfirmDelete(o){this.editItem=o,this.showDeleteSupervisorModal=!0},closeAllModals(){this.editItem={},this.showFormSupervisorModal=!1,this.showDeleteSupervisorModal=!1},handleLoadMore(o){this.page+=o,this.getSupervisors()}},computed:{filters(){return{page:this.page,filter:this.search}}}},z={class:"card"},G=["onClick"],H=["onClick"];function J(o,e,d,u,r,s){const l=n("Icon"),c=n("DataTable"),p=n("FormSupervisorModal"),i=n("DeleteSupervisorModal");return S(),D(O,null,[t("main",null,[t("section",z,[t("header",null,[e[3]||(e[3]=t("h1",null,"Supervisores",-1)),t("button",{class:"rounded",onClick:e[0]||(e[0]=h=>r.showFormSupervisorModal=!0)},[a(l,{icon:"tdesign:user-add"})])]),a(c,{items:r.items,columns:r.columns,loading:r.loading,totalItems:r.total,totalPage:r.totalPage,currentPage:r.page,onOnSearch:s.handleSearch,onOnNextPage:e[1]||(e[1]=h=>s.handleLoadMore(1)),onOnPreviousPage:e[2]||(e[2]=h=>s.handleLoadMore(-1))},{actions:m(({item:h})=>[t("button",{class:"rounded success",onClick:_=>s.handleEditSupervisor(h)},[a(l,{icon:"carbon:edit"})],8,G),t("button",{class:"rounded danger",onClick:_=>s.handleConfirmDelete(h)},[a(l,{icon:"carbon:trash-can"})],8,H)]),_:1},8,["items","columns","loading","totalItems","totalPage","currentPage","onOnSearch"])])]),a(p,{show:r.showFormSupervisorModal,dataForm:r.editItem,onOnClose:s.closeAllModals,onOnSave:s.refresh},null,8,["show","dataForm","onOnClose","onOnSave"]),a(i,{show:r.showDeleteSupervisorModal,dataForm:r.editItem,onOnClose:s.closeAllModals,onOnConfirm:s.refresh},null,8,["show","dataForm","onOnClose","onOnConfirm"])],64)}const oe=g(U,[["render",J],["__scopeId","data-v-5429bf4a"]]);export{oe as default};
