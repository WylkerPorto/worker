import{D as b}from"./DataTable-DTdJEoNs.js";import{_,h as y,w as d,e as n,f as g,r,a as s,g as k,o as f,I as C,t as S,c as M,F as I}from"./index-BBRSQRce.js";import{F as O,c as B,a as E}from"./FormInput-_lWEs26c.js";import{M as w}from"./ModalBase-DW8xj3ep.js";import{M as v}from"./MyButton-CPGQxF9f.js";import{u as F,c as x,r as A,l as T}from"./department-BZbtGlhw.js";import"./SearchInput-Dz10qtPx.js";import"./conversors-BXIEm-hF.js";import"./http-C1CqThx4.js";const N={name:"FormDepartmentModal",components:{ModalBase:w,FormInput:O,MyButton:v},props:{show:{type:Boolean,default:!1},dataForm:{type:Object}},emits:["onClose","onSave"],data(){return{form:{status:!1},errors:{},loading:!1}},watch:{dataForm(){this.dataForm&&(this.form={...this.form,...this.dataForm})}},methods:{validate(){B({name:E().required("Setor é obrigatório")}).validate(this.form,{abortEarly:!1}).then(()=>{this.errors={},this.saveDepartment()}).catch(t=>{const i={};t.inner.forEach(h=>{i[h.path]=h.message}),this.errors=i})},async saveDepartment(){this.loading=!0;try{const e=!!this.form.id;e?(delete this.form.id,delete this.form.createdAt,delete this.form.updatedAt,delete this.form.deletedAt,await F(this.dataForm.id,this.form)):await x(this.form),this.$snotify.success(`Setor ${e?"atualizado":"criado"} com sucesso`),this.$emit("onSave"),this.closeModal()}catch(e){this.$snotify.error("Erro ao salvar o setor: "+e)}finally{this.loading=!1}},closeModal(){this.form={status:!1},this.errors={},this.$emit("onClose")}}};function V(e,t,i,h,o,a){const l=r("FormInput"),u=r("MyButton"),p=r("ModalBase");return f(),y(p,{open:i.show,loading:o.loading,title:"Novo Setor",onOnClose:a.closeModal},{content:d(()=>[s("form",{onSubmit:t[1]||(t[1]=k((...m)=>a.validate&&a.validate(...m),["prevent"]))},[n(l,{label:"Setor",type:"text",placeholder:"Digite o setor",modelValue:o.form.name,"onUpdate:modelValue":t[0]||(t[0]=m=>o.form.name=m),error:o.errors.name,required:""},null,8,["modelValue","error"])],32)]),actions:d(()=>[n(u,{class:"btn success",loading:o.loading,onClick:a.validate},{default:d(()=>t[2]||(t[2]=[g(" Salvar ")])),_:1},8,["loading","onClick"])]),_:1},8,["open","loading","onOnClose"])}const q=_(N,[["render",V],["__scopeId","data-v-bba34f1c"]]),z={name:"DeleteDepartmentModal",components:{ModalBase:w,Icon:C,MyButton:v},props:{show:{type:Boolean,default:!1},dataForm:{type:Object}},emits:["onClose","onConfirm"],data(){return{loading:!1}},methods:{async deleteDepartment(){this.loading=!0;try{await A(this.dataForm.id),this.$snotify.success("Setor excluído com sucesso!"),this.$emit("onConfirm"),this.$emit("onClose")}catch(e){this.$snotify.error("Erro ao excluir o setor: "+e)}finally{this.loading=!1}}}};function L(e,t,i,h,o,a){const l=r("Icon"),u=r("MyButton"),p=r("ModalBase");return f(),y(p,{open:i.show,loading:o.loading,title:"Confirmar Exclusão",onOnClose:t[0]||(t[0]=m=>e.$emit("onClose"))},{content:d(()=>[s("section",null,[n(l,{icon:"carbon:warning"}),s("div",null,[s("p",null,[t[1]||(t[1]=g(" Tem certeza que deseja excluir o setor ")),s("span",null,S(i.dataForm?.name),1),t[2]||(t[2]=g(" ? "))]),t[3]||(t[3]=s("p",null,"Essa ação não pode ser desfeita!",-1))])])]),actions:d(()=>[n(u,{class:"btn danger",loading:o.loading,onClick:a.deleteDepartment},{default:d(()=>t[4]||(t[4]=[g("Confirmar")])),_:1},8,["loading","onClick"])]),_:1},8,["open","loading"])}const j=_(z,[["render",L],["__scopeId","data-v-fa4fd001"]]),$={name:"RecruiterDepartment",components:{DataTable:b,Icon:C,FormDepartmentModal:q,DeleteDepartmentModal:j},data(){return{showFormDepartmentModal:!1,showDeleteDepartmentModal:!1,loading:!1,columns:[{key:"name",title:"Nome"},{key:"status",title:"Status",type:"boolean"},{key:"createdAt",title:"Criado em",type:"date"}],items:[],editItem:{},total:0,page:1,search:""}},mounted(){this.getDepartments()},methods:{refresh(){this.items=[],this.getDepartments()},async getDepartments(){this.closeAllModals(),this.loading=!0;try{const e=await T(this.filters);this.items.push(...e.data),this.total=e.data.total}catch(e){this.$snotify.error("Erro ao buscar os setor: "+e)}finally{this.loading=!1}},async handleToggleDepartment(e){this.loading=!0;try{e.status=!e.status,await F(e.id,{status:e.status}),this.$snotify.success("Setor atualizado com sucesso!")}catch(t){this.$snotify.error("Erro ao atualizar o setor: "+t),e.status=!e.status}finally{this.loading=!1}},handleSearch(e){this.search=e,this.page=1,this.items=[],this.getDepartments()},handleNewDepartment(){this.editItem={},this.showFormDepartmentModal=!0},handleEditDepartment(e){this.editItem=e,this.showFormDepartmentModal=!0},handleConfirmDelete(e){this.editItem=e,this.showDeleteDepartmentModal=!0},closeAllModals(){this.editItem={},this.showFormDepartmentModal=!1,this.showDeleteDepartmentModal=!1},handleLoadMore(){this.page+=1,this.getDepartments()}},computed:{filters(){return{page:this.page,filter:this.search}},loadMore(){return this.items.length<this.total}}},P={class:"card"},R=["onClick"],U=["onClick"],G=["onClick"],H=["onClick"];function J(e,t,i,h,o,a){const l=r("Icon"),u=r("DataTable"),p=r("FormDepartmentModal"),m=r("DeleteDepartmentModal");return f(),M(I,null,[s("main",null,[s("section",P,[s("header",null,[t[1]||(t[1]=s("h1",null,"Setores",-1)),s("button",{class:"rounded",onClick:t[0]||(t[0]=c=>o.showFormDepartmentModal=!0),title:"Novo Setor"},[n(l,{icon:"qlementine-icons:new-16"})])]),n(u,{items:o.items,columns:o.columns,loading:o.loading,total:o.items.length,loadMore:a.loadMore,onOnLoadMore:a.handleLoadMore,onOnSearch:a.handleSearch},{actions:d(({item:c})=>[c.status?(f(),M("button",{key:0,class:"rounded warning",onClick:D=>a.handleToggleDepartment(c),title:"Pausar"},[n(l,{icon:"ic:round-pause"})],8,R)):(f(),M("button",{key:1,class:"rounded primary",onClick:D=>a.handleToggleDepartment(c),title:"Ativar"},[n(l,{icon:"ic:round-play-arrow"})],8,U)),s("button",{class:"rounded success",onClick:D=>a.handleEditDepartment(c)},[n(l,{icon:"carbon:edit"})],8,G),s("button",{class:"rounded danger",onClick:D=>a.handleConfirmDelete(c)},[n(l,{icon:"carbon:trash-can"})],8,H)]),_:1},8,["items","columns","loading","total","loadMore","onOnLoadMore","onOnSearch"])])]),n(p,{show:o.showFormDepartmentModal,dataForm:o.editItem,onOnClose:a.closeAllModals,onOnSave:a.refresh},null,8,["show","dataForm","onOnClose","onOnSave"]),n(m,{show:o.showDeleteDepartmentModal,dataForm:o.editItem,onOnClose:a.closeAllModals,onOnConfirm:a.refresh},null,8,["show","dataForm","onOnClose","onOnConfirm"])],64)}const ae=_($,[["render",J],["__scopeId","data-v-491ed770"]]);export{ae as default};
