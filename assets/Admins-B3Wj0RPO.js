import{M as w,D as F}from"./ModalBase-D0JD0HBS.js";import{_ as M,h as _,w as m,e as a,f as p,r as i,a as s,g as b,o as A,I as C,t as I,c as D,F as O}from"./index-BPNaUcx8.js";import{F as B,c as E,a as f}from"./http-j0rTDgai.js";import{M as y}from"./MyButton-B6g7ln0j.js";import{u as k,c as S,r as x,l as V}from"./user-Dt7GlIK-.js";const q={name:"FormAdminModal",components:{ModalBase:w,FormInput:B,MyButton:y},props:{show:{type:Boolean,default:!1},dataForm:{type:Object}},emits:["onClose","onSave"],data(){return{form:{permission_id:0},errors:{},loading:!1}},watch:{dataForm(){this.dataForm&&(this.form={...this.form,...this.dataForm})}},methods:{validate(){E({name:f().required("Nome é obrigatório"),email:f().email("E-mail inválido").required("E-mail é obrigatório"),password:this.form.id?f().min(6,"Senha deve ter pelo menos 6 caracteres").notRequired():f().min(6,"Senha deve ter pelo menos 6 caracteres").required("Senha é obrigatória")}).validate(this.form,{abortEarly:!1}).then(()=>{this.errors={},this.saveAdmin()}).catch(e=>{const d={};e.inner.forEach(c=>{d[c.path]=c.message}),this.errors=d})},async saveAdmin(){this.loading=!0;try{const o=!!this.form.id;o&&(delete this.form.id,delete this.form.createdAt,delete this.form.updatedAt),o&&!this.form.password&&delete this.form.password,o?await k(this.dataForm.id,this.form):await S(this.form),this.$snotify.success(`Administrador ${o?"atualizado":"salvo"} com sucesso!`),this.$emit("onSave"),this.closeModal()}catch(o){this.$snotify.error("Erro ao salvar o administrador: "+o)}finally{this.loading=!1}},closeModal(){this.form={permission_id:0},this.errors={},this.$emit("onClose")}}};function N(o,e,d,c,t,n){const l=i("FormInput"),h=i("MyButton"),u=i("ModalBase");return A(),_(u,{open:d.show,loading:t.loading,title:"Novo Administrador",onOnClose:n.closeModal},{content:m(()=>[s("form",{onSubmit:e[3]||(e[3]=b((...r)=>n.validate&&n.validate(...r),["prevent"]))},[a(l,{label:"Nome",type:"text",placeholder:"Digite o nome",modelValue:t.form.name,"onUpdate:modelValue":e[0]||(e[0]=r=>t.form.name=r),error:t.errors.name,required:""},null,8,["modelValue","error"]),a(l,{label:"E-mail",type:"email",placeholder:"Digite o e-mail",modelValue:t.form.email,"onUpdate:modelValue":e[1]||(e[1]=r=>t.form.email=r),error:t.errors.email,required:""},null,8,["modelValue","error"]),a(l,{label:"Senha",type:"password",placeholder:"Digite a senha",modelValue:t.form.password,"onUpdate:modelValue":e[2]||(e[2]=r=>t.form.password=r),error:t.errors.password,required:""},null,8,["modelValue","error"])],32)]),actions:m(()=>[a(h,{class:"btn success",loading:t.loading,onClick:n.validate},{default:m(()=>e[4]||(e[4]=[p(" Salvar ")])),_:1},8,["loading","onClick"])]),_:1},8,["open","loading","onOnClose"])}const T=M(q,[["render",N],["__scopeId","data-v-4f11d35b"]]),L={name:"DeleteAdminModal",components:{ModalBase:w,Icon:C,MyButton:y},props:{show:{type:Boolean,default:!1},dataForm:{type:Object}},emits:["onClose","onConfirm"],data(){return{loading:!1}},methods:{async deleteAdmin(){this.loading=!0;try{await x(this.dataForm.id),this.$snotify.success("Administrador excluído com sucesso!"),this.$emit("onConfirm"),this.$emit("onClose")}catch(o){this.$snotify.error("Erro ao excluir o administrador: "+o)}finally{this.loading=!1}}}};function j(o,e,d,c,t,n){const l=i("Icon"),h=i("MyButton"),u=i("ModalBase");return A(),_(u,{open:d.show,loading:t.loading,title:"Confirmar Exclusão",onOnClose:e[0]||(e[0]=r=>o.$emit("onClose"))},{content:m(()=>[s("section",null,[a(l,{icon:"carbon:warning"}),s("div",null,[s("p",null,[e[1]||(e[1]=p(" Tem certeza que deseja excluir o administrador ")),s("span",null,I(d.dataForm?.name),1),e[2]||(e[2]=p(" ? "))]),e[3]||(e[3]=s("p",null,"Essa ação não pode ser desfeita!",-1))])])]),actions:m(()=>[a(h,{class:"btn danger",loading:t.loading,onClick:n.deleteAdmin},{default:m(()=>e[4]||(e[4]=[p("Confirmar")])),_:1},8,["loading","onClick"])]),_:1},8,["open","loading"])}const U=M(L,[["render",j],["__scopeId","data-v-34a7eccb"]]),z={name:"AdminController",components:{DataTable:F,Icon:C,FormAdminModal:T,DeleteAdminModal:U},data(){return{showFormAdminModal:!1,showDeleteAdminModal:!1,loading:!1,columns:[{title:"Nome",key:"name"},{title:"Email",key:"email"},{title:"Criado",key:"createdAt",type:"date"}],items:[],editItem:{},total:0,page:1,search:""}},mounted(){this.getAdmins()},methods:{async getAdmins(){this.closeAllModals(),this.loading=!0;try{const o=await V(this.filters);this.items.push(...o.data.data),this.total=o.data.total}catch(o){this.$snotify.error("Erro ao buscar os administradores: "+o)}finally{this.loading=!1}},handleSearch(o){this.search=o,this.page=1,this.getAdmins()},handleNewAdmin(){this.editItem={},this.showFormAdminModal=!0},handleEditAdmin(o){this.editItem=o,this.showFormAdminModal=!0},handleConfirmDelete(o){this.editItem=o,this.showDeleteAdminModal=!0},closeAllModals(){this.editItem={},this.showFormAdminModal=!1,this.showDeleteAdminModal=!1},handleLoadMore(){this.page+=1,this.getAdmins()}},computed:{filters(){return{page:this.page,filter:this.search}},loadMore(){return this.items.length<this.total}}},R={class:"card"},G=["onClick"],H=["onClick"];function J(o,e,d,c,t,n){const l=i("Icon"),h=i("DataTable"),u=i("FormAdminModal"),r=i("DeleteAdminModal");return A(),D(O,null,[s("main",null,[s("section",R,[s("header",null,[e[1]||(e[1]=s("h1",null,"Administradores",-1)),s("button",{class:"rounded",onClick:e[0]||(e[0]=g=>t.showFormAdminModal=!0)},[a(l,{icon:"tdesign:user-add"})])]),a(h,{items:t.items,columns:t.columns,loading:t.loading,total:t.total,loadMore:n.loadMore,onOnLoadMore:n.handleLoadMore,onOnSearch:n.handleSearch},{actions:m(({item:g})=>[s("button",{class:"rounded success",onClick:v=>n.handleEditAdmin(g)},[a(l,{icon:"carbon:edit"})],8,G),s("button",{class:"rounded danger",onClick:v=>n.handleConfirmDelete(g)},[a(l,{icon:"carbon:trash-can"})],8,H)]),_:1},8,["items","columns","loading","total","loadMore","onOnLoadMore","onOnSearch"])])]),a(u,{show:t.showFormAdminModal,dataForm:t.editItem,onOnClose:n.closeAllModals,onOnSave:n.getAdmins},null,8,["show","dataForm","onOnClose","onOnSave"]),a(r,{show:t.showDeleteAdminModal,dataForm:t.editItem,onOnClose:n.closeAllModals,onOnConfirm:n.getAdmins},null,8,["show","dataForm","onOnClose","onOnConfirm"])],64)}const Y=M(z,[["render",J],["__scopeId","data-v-de823e19"]]);export{Y as default};
