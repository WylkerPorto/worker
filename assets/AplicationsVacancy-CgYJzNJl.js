import{u as w,g as k}from"./aplication-BbQEJJud.js";import{c as _}from"./filters-hxkp4Hkv.js";import{a as C}from"./vacancy-CjHoOqcr.js";import{D}from"./DataTable-lpC7ORQz.js";import{I as S,_ as I,c,a as s,d as V,e as r,r as u,t as h,w as g,n as v,F as A,i as b,o as d}from"./index-C0iXwPwW.js";import"./http-lBh2inUk.js";import"./conversors-Bxahe57Q.js";import"./SearchInput-wRdvrFLq.js";import"./MyButton-8NTvTHKk.js";const P={name:"AplicationsVacancy",components:{DataTable:D,Icon:S},data(){return{openDropdownItem:null,dropdownStyles:{position:"absolute",top:"0px",left:"0px"},vaga:{},items:[],columns:[{key:"person.name",title:"Nome"},{key:"person.email",title:"Email"},{key:"status",title:"Estado"},{key:"createdAt",title:"Criado em",type:"date"}],aplicationStatus:[],loading:!1,total:0,page:1,totalPage:0,search:""}},mounted(){this.getAplicationsByVacancy(),this.getVacancyDetail(),this.getAplicationStatus(),document.addEventListener("click",this.handleClickOutside)},beforeUnmount(){document.removeEventListener("click",this.handleClickOutside)},methods:{async getAplicationStatus(){try{const t=await _();this.aplicationStatus=t.data}catch(t){this.$snotify.error(t)}},async getAplicationsByVacancy(){this.loading=!0;try{const{data:t}=await k(this.$route.params.id,this.filters);this.items=t.data,this.total=t.meta.total,this.totalPage=t.meta.totalPages}catch(t){this.$snotify.error(t)}finally{this.loading=!1}},async getVacancyDetail(){this.loading=!0;try{const t=await C(this.$route.params.id);this.vaga=t.data}catch(t){this.$snotify.error(t)}finally{this.loading=!1}},handleLoadMore(t){this.page+=t,this.getAplicationsByVacancy()},handleSearch(t){this.search=t,this.page=1,this.items=[],this.getAplicationsByVacancy()},async handleToggleStatus(t,e){this.loading=!0;const a={...t};try{a.status=e,delete a.id,delete a.updatedAt,delete a.createdAt,delete a.vacancy,delete a.person,console.log("Atualizando candidatura:",a),await w(t.id,a),this.$snotify.success("Candidatura atualizada com sucesso!"),t.status=e}catch(l){this.$snotify.error("Erro ao atualizar candidatura: "+l)}finally{this.openDropdownItem=null,this.loading=!1}},toggleDropdown(t,e){const a=t.target.getBoundingClientRect();if(this.openDropdownItem===e){this.openDropdownItem=null;return}this.openDropdownItem=e,this.dropdownStyles={position:"absolute",top:`${a.bottom+8}px`,left:`${a.left-60}px`}},handleClickOutside(t){setTimeout(()=>{const e=this.$refs.dropdown,a=t.target,l=t.target.closest(".actions");e&&!e.contains(a)&&!l&&(this.openDropdownItem=null)},0)}},computed:{filters(){return{page:this.page,search:this.search}}}},B={class:"card"},x=["onClick"],L=["onClick"];function E(t,e,a,l,o,i){const p=u("Icon"),y=u("RouterLink"),f=u("DataTable");return d(),c("main",null,[s("section",B,[s("header",null,[s("button",{class:"rounded",onClick:e[0]||(e[0]=n=>t.$router.push({name:"recruiterVacancy"})),title:"Voltar"},[r(p,{icon:"lets-icons:back"})]),s("h1",null,"Candidatos a vaga "+h(o.vaga.title),1)]),r(f,{items:o.items,columns:o.columns,loading:o.loading,totalItems:o.total,totalPage:o.totalPage,currentPage:o.page,onOnSearch:i.handleSearch,onOnNextPage:e[1]||(e[1]=n=>i.handleLoadMore(1)),onOnPreviousPage:e[2]||(e[2]=n=>i.handleLoadMore(-1))},{actions:g(({item:n})=>[s("button",{class:"rounded",onClick:m=>i.toggleDropdown(m,n),title:"Editar Status"},[r(p,{icon:"fluent:status-12-filled"})],8,x),r(y,{class:"rounded primary",to:{name:"recruiterCandidateDetail",params:{id:n.person.id}},title:"Ver Candidato",target:"_blank"},{default:g(()=>[r(p,{icon:"mdi:user"})]),_:2},1032,["to"])]),_:1},8,["items","columns","loading","totalItems","totalPage","currentPage","onOnSearch"])]),o.openDropdownItem?(d(),c("article",{key:0,ref:"dropdown",style:v(o.dropdownStyles),class:"dropdown-status"},[s("ul",null,[(d(!0),c(A,null,b(o.aplicationStatus,n=>(d(),c("li",{key:n.id,onClick:m=>i.handleToggleStatus(o.openDropdownItem,n.title)},h(n.title),9,L))),128))])],4)):V("",!0)])}const j=I(P,[["render",E],["__scopeId","data-v-6a285026"]]);export{j as default};
